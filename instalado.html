<html>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <title>Renkontiĝo-Administrilo (instalado)</title>
  </head>
  <body>
    <h1>Renkontiĝo-Administrilo</h1>
    <p>(vidu la <a href='./'>&#265;efpa&#285;on</a>.</p>
    
    <h2>Instalado</h2>

    <p>Jen dua versio de la instal-gvidilo, kun adapto al la ekzisto
      de la instal-skripto por krei datumbazajn tabelojn.</p>

    <h3>Bezonataĵoj</h3>
    <ul>
      <li>retservilo</li>
      <li>PHP-instalaĵo (konektata al la retservilo)</li>
      <li>MySQL-datumbazsistemo </li>
      <li>Ajna rekta aliro al la DB-sistemo - ekzemple per PHPMyAdmin
        aŭ per Shell-aliro al komputilo kun Mysql-kliento</li>
    </ul>
    
    <h3>instalado</h3>

    <p>(Mi por la ekranfotoj uzis la germanlingva versio de PHPMyAdmin,
        kiu estis instalita &#265;e Berlios.de. En alilingva versio
		  kompreneble aspektos iom alie, sed espereble tamen
		  rekoneblos ...)
	</p>

    <ol>
      <li>Kreu datumbazon en la DB-sistemo (ajna nomo, sed memoru ĝin).
	(En nia ekzemplo, la nomo estas <code>aligilo</code>.)
      </li>
      <li>
	Kreu uzanton por la datumbaza sistemo (aŭ uzu iun jam ekzistantan),
	kaj donu al ĝi la sekvajn rajtojn por la datumbazo:
	<code>CREATE TABLE</code> (nur dum la instalado),
	<code>SELECT</code>, <code>INSERT</code>,
	<code>UPDATE</code>, <code>CREATE TEMPORARY TABLE</code>.
      </li>
<!--
      <li>En tiu datumbazo kreu diversajn tabelojn,
        laŭ <code>programo/doku/aligilo-tabeloj.sql</code>
        (en la SVN).
			(<a href='bildoj/importado-1.png'>Ekranfoto</a>).
        (Vi povas - en la dosiero - anstataŭi la prefikson 'is_' per iu alia - tio
        estas utila, se vi volas uzi plurajn tiajn sistemojn en
        la sama datumbazo, aŭ tiun kaj aliajn sistemojn, kaj tuj vidi,
        pri kia tabelo temas. Tiam vi poste devos adapti la prefikson
		  en <code>opcioj.php</code>)
      </li>
      <li>
        En la <em>entajpantoj</em>-tabelon, enmetu unu komencan uzanton kun
        la rajtoj (almenaŭ)
        <code>vidi</code>,  <code>administri</code> kaj
        <code>teknikumi</code> (t.e. metu 'J' en tiujn kampojn
        de la tabelo), iun pasvorton (memoru ĝin), iun nomon.
			(Ekranfotoj de PHPMyAdmin: <a href='bildoj/entajpantoj-1.png'>1</a>,
			 <a href='bildoj/entajpantoj-2.png'>2</a>, <a href='bildoj/entajpantoj-3.png'>3</a>,
			 a&#365; vi uzu la sekvan SQL.)
			<blockquote><pre>INSERT INTO `is_entajpantoj`
    ( `ID` , `nomo` , `kodvorto` , `retposxtadreso` , `partoprenanto_id` ,
      `aligi` , `vidi` , `sxangxi` , `cxambrumi` , `ekzporti` , `statistikumi` ,
      `mono` , `estingi` , `retumi` , `rabati` , `administri` , `akcepti` , `teknikumi`
    ) 
VALUES
    ( NULL , 'admin', '<var>via pasvorto</var>', '', NULL , 'N', 'J', 'N', 'N', 'N', 'N', 'N',
      'N', 'N', 'N', 'J', 'N', 'J'
     );</pre></blockquote>
      </li>
      <li>
        Kreu almenaŭ unu renkontiĝon en la renkontiĝo-tabelo
        (almenaŭ 'nomo', 'mallongigo', 'ID' - la reston oni
        poste povas en la programo ŝangi).
		  (Ekranfotoj: <a href='bildoj/renkontigxo-1.png'>1</a>,
			 <a href='bildoj/renkontigxo-2.png'>2</a>, a&#365; uzu la sekvan SQL-kodon.)
<blockquote><pre>INSERT INTO `is_renkontigxo`
    ( `ID` , `nomo` , `mallongigo` , `temo` , `loko` , `de` , `gxis` , `plej_frue` ,
      `meze` , `parttemppartoprendivido` , `juna` , `maljuna` , `adminrespondeculo` ,
      `adminretadreso` , `sekurkopiojretadreso` , `invitleterorespondeculo` ,
      `invitleteroretadreso` , `temarespondulo` , `temaretadreso` , `distrarespondulo` ,
      `distraretadreso` , `vesperarespondulo` , `vesperaretadreso` , `muzikarespondulo` ,
      `muzikaretadreso` , `noktarespondulo` , `noktaretadreso` , `novularespondulo` ,
      `novularetadreso` ) 
VALUES
    ( '7', 'Ekzempla renkontig^o 2007', 'ER 2007', '0', '0', '0000-00-00', '0000-00-00',
      '0000-00-00', '0000-00-00', '6', '20', '26', '', '', '', '', '', '', '', '', '',
      '', '', '', '', '', '', '', ''
    );</pre></blockquote>
      </li>
-->
      <li>
        Kopiu la dosierojn en <code>programo/</code> al via retservilo.
        (Se vi havas Shell-aliron kaj
        instalitan Subversion tie, eblas rekte preni ilin tien, ekzemple per
				<blockquote><code>svn checkout svn://svn.berlios.de/aligilo/programo </code>[<var>〈dosierujo〉</var>]</blockquote>
			en la gepatra dosierujo. (<a href='bildoj/programo-1.png'>Ekranfoto</a>.))
      </li>
      <li>
	Indas pasvort-protekti la tutan dosierujon per
	<a href='http://httpd.apache.org/docs/1.3/howto/auth.html'><code>.htaccess</code></a>,
	por ke neniu misuzu ion - la programo nuntempe ne estas aparte
	sekura kontra&#365; per-retaj atakoj. Por tio, vi povas fari kopion de
	<code>htaccess-sxablono</code> kaj ŝanĝi la necesajn partojn, kaj
	krei per la programo <code>htpasswd</code> la pasvort-dosieron.
      </li>
      <!--
      <li>
        Je aktualaj PHP-versioj (kie oni ne ŝanĝis la ĝeneralan konfiguron)
        necesas aldoni la sekvan linion al la <code>.htaccess</code>-dosiero
        en la programa dosierujo:
        <pre>php_flag register_globals on</pre>.
        <em>(Mi esperas, ke iu estonta versio de la programo ne plu
          bezonos tion.)</em>
      </li>
      -->
      <li>
	Kopiu la tutan dosierujon <code>konfiguro-sxablono</code> al
	<code>konfiguro</code>.
      </li>
      <li>
        En <code>konfiguro</code> necesas ŝanĝi datumaro.php, kaj
            (iam poste) indas ŝanĝi (aŭ almenaŭ rigardi) la aliajn:
        <dl>
          <dt>datumaro.php</dt>
          <dd>
            Enmetu la konektajn parametrojn por via datumbazo - uzantnomo,
	    pasvorto kaj datumbaznomo. (Eblas enmeti diversajn por diversaj
	    variantoj de la programo, elektebla per moduso.php - sed unue
	    enmetu &#265;e "monde". -
	    <a href='bildoj/datumaro-php.png'>Ekranfoto</a>.)
	    <p>
	      Per <code>$tabelnomprefikso</code> vi povas indiki prefikson por
	      ĉiuj uzotaj (kaj kreotaj) tabeloj - tio necesas, se vi havos
	      tabelojn por pluraj programoj en la sama datumbazo. Se vi povas
	      krei (sen kromkostoj) plurajn datumbazojn, tio kutime estas
	      preferinda.
	    </p>
          </dd>
          <dt>moduso.php</dt>
          <dd>
            Jen simpla maniero per unu ŝaltilo ŝangi la tutan skripton inter
            diversaj rul-manieroj, samtempe konservante ĉiujn aliajn aferojn ...
            <p>
            Mi nuntempe ĉiam uzas <code>monde</code> kiel moduso en la retejo,
            <code>teste</code> por la (reteja) test-datumbazo kaj iam uzis
            <code>hejme</code> por hejma instalado. datumaro.php laŭ tiu decidas, al kiu datumbazo konekti.
              </p>
	    <p>
            Per <code>EBLAS_SKRIBI</code> eblas ŝalti al nurlega moduso,
            utila, se vi kopias la datumbazon por surloka uzo, kaj volas
            malpermesi iujn ŝanĝojn en la reteja versio (kio tamen restas
            atingebla por serĉi informojn) - alikaze vi poste havos la
            problemon de du diversaj datumbaz-enhavoj.
	    </p>
	    <p>
	      Per <code>INSTALA_MODUSO</code> eblas ŝalti/malŝalti la
	      instalan moduson (uzota en la sekva paŝo). Ĝi devus komence
	      jam esti ŝaltita - post la instalado malŝaltu ĝin.
	    </p>
          </dd>
          <dt>opcioj.php</dt>
          <dd>
            Tie eblas elekti el diversaj opcioj ... simple rigardu.
            (Pliaj verŝajne aldoniĝos.)
          </dd>
<!--          <dt>objektoj_kotizo.php</dt>
          <dd>
            La kotizokalulilo ... preskaŭ certe adaptenda por
            via kotizosistemo (sed ne necesas tuj)
          </dd> -->
        </dl>
      </li>
      <li>Igu la dosierujon <code>dosieroj_generitaj</code> skribebla
	por la servilo.
      </li>
      <li>Nun ni kreos la datumbazojn: navigu al
	<code>aligilo/instalilo/</code>. Tie vi vidas (post resumo de la supraj paŝoj)
	sub <em>Instalilo</em> tri ligojn.
	<p>Unue elektu <em>Kreu datumbazon</em>.
	  Ĝi montras plurajn SQL-ordonojn,
	  kiujn ĝi ankaŭ sendas al la datumbazo.
	  Se ĝi ne donas erarojn, vi reiru.</p>
	  <p>Due elektu <em>Komencaj datumoj</em> - tiu paĝo kreas
	    la landoliston (ne tute kompleta - ĉu iu volas doni pli
	    kompletan liston al ni?), bazajn kondiĉojn por kotizokalkulado ktp.,
	    kaj simplan kotizosistemon (kun nur unu kategorio).
	  </p>
	  <p>Trie elektu <em>Unua uzanto kaj renkontiĝo</em> - tie necesas
	    enmeti nomon kaj pasvorton por unua uzanto (atentu, la pasvorto poste
	    estos montrota; eble uzu provizore iun negravan, vi poste en la programo
	    povas ŝanĝi), kaj nomon kaj mallongigon por la unua renkontiĝo.
	  </p>
	  <p>
	    (Por povi eniri la sistemon normale necesas almenaŭ unu uzanto kaj unu
	    renkontiĝo, kaj por la renkontiĝo necesas havi kotizosistemon. Pro tio
	    bezonatas tiuj paŝo de la instalilo.)
	  </p>
      </li>
      <li>
	Post la instalado, vi malŝaltu en <code>konfiguro/moduso.php</code> la instalan
	moduson.
      </li>
      <li>
        Teorie nun ĉio devus funkcii - voku (per retumilo) la dosierujon
        (aŭ <code>index.php</code>, se la dosierujo mem ne faras tion), en kiun
        vi metis la aĵojn. Vi devus vidi bonvenigan mesaĝon, dekstre
        kun identigo-alvoko kaj elekto de renkontiĝo. (<a href='bildoj/elprovo-1.png'>Ekranfoto</a>)
      </li>
      <li>
        Salutu kun la uzantnomo (kaj pasvorto), kiun vi kreis antaŭe. (<a href='bildoj/elprovo-2.png'>Ekranfoto</a>)
      </li>
      <li>
        Iru al <em>Grava administrado</em> (en la maldekstra menuo - <a href='bildoj/elprovo-3.png'>Ekranfoto</a>),
        kaj elektu (tute sube) <em>redaktu la entajpantoliston</em>.
        Tie vi povas aldoni pliajn uzantojn, doni pasvortojn kaj rajtojn.
		 (Ekranfotoj: <a href='bildoj/administrado-1.png'>1</a>, <a href='bildoj/administrado-2.png'>2</a>, <a href='bildoj/administrado-3.png'>3</a>)
      </li>
      <li>
	Iru denove al <em>Grava administrado</em>, kaj elektu
	<em>redaktu la renkontiĝo-datumojn</em>. Antaŭ la aliĝo de unua partoprenanto
	necesas enmeti almenaŭ la daton de la renkontiĝo.
      </li>
      <li>
        <em>(pli sekvos: aliĝilo, ...)</em>.
      </li>
    </ol>

    <hr/>

    <h3>Eblaj aliaj problemoj</h3>
    <p>
      Mi ĵus (2010-03-06) instalis la programon en la Apache de Ubuntu (mia
      hejma komputilo).
      Tie montriĝis (apud pluraj aliaj pro ne-kongruaj datumbazstrukturo
      kaj programo, kiujn mi korektis, kie mi trovis) du problemoj:
    </p>
    <ul>
      <li><code>register_globals</code> estas nun ĉiam  malŝaltita, kio ofte
	gvidas al tio, ke iu paĝo ne povas legi siajn parametrojn (ĉar nun la
	elementoj de $_REQUEST ne aŭtomate iĝas globalaj variabloj).
	<p>
	Principe tio estas bona, sed en nia programo estas ankoraŭ pluraj
	lokoj, kie ni atendas la malnovan manieron.
	</p>
	La solvo estas trairi ĉiujn dosierojn kaj anstataŭi
	<code>$variablo</code> per <code>$_REQUEST['variablo']</code>,
	kie temas pri variablo sendita per formularo aŭ ligo.
      </li>
      <li>Se oni havas PHP kun instalita
	<a href="http://www.hardened-php.net/suhosin/">Suhosin-aldonaĵo</a>,
	estas limo en la kvanto de variabloj sendita de formularo. La
	ĝenerala serĉo uzas ege grandan kvanton de tiaj variabloj, kio
	rezultas en fortondado post la 200-a, kaj ALERT-mesaĝo en la
	eraro-protokolo (error.log) de la servilo. La du ordonoj
	<pre>
	  suhosin.post.max_vars = 1000
	  suhosin.request.max_vars = 1000
	</pre>
	en la php.ini (respektive /etc/php5/apache2/conf.d/suhosin.ini en mia
	sistemo) helpis. (200 estis la defaŭlta valoro, 500 ne sufiĉis.)
	Necesas reŝarĝi la konfiguron de la servilo, ekzemple per
	<code>sudo /etc/init.d/apache2 reload</code>.
	<p>
	Estas pripensenda ŝanĝi la sistemon de la ĝenerala serĉo tiel, ke
	ĝi ne bezonu tiom multajn variablojn. (Kaj ĝenerale, ke ne estu tiom
	multaj datumoj senditaj - granda parto el ili ja tute neniam ŝanĝiĝas,
	kaj povus resti ĉe la servilo.)</p>
      </li>
    </ul>

    <p>
<a href="http://developer.berlios.de" title="BerliOS Developer"> <img src="http://developer.berlios.de/bslogo.php?group_id=8006" width="124px" height="32px" border="0" alt="BerliOS Developer Logo"></a>
      </p>
  </body>
</html>
